---
description: 
globs: 
alwaysApply: true
---
# Project Structure Guide

This rule explains the folder structure of the project. Use this as a reference for navigating and understanding the codebase.

This project is a monorepo that utilizes turborepo.

## Root Directory

The root contains configuration files and the main project folders:

- `package.json`: Project dependencies and scripts.
- `pnpm-workspace.yaml`: Defines the workspaces in the monorepo (e.g., `apps/*`, `packages/*`).
- `turbo.json`: Turborepo configuration, defining pipelines and task dependencies.
- `tsconfig.json`: Base TypeScript configuration for the entire monorepo.
- `.gitignore`: Specifies intentionally untracked files that Git should ignore (e.g., `node_modules`, build outputs, `.env` files).
- `docker-compose.yml`: Defines and runs multi-container Docker applications, likely for local development environment (e.g., database, services).
- `.npmrc`: Configuration for npm, potentially empty or used for specifying registry or other settings.
- `.gitmodules`: Defines submodules if the project uses them.
- `README.md`: General information about the project.

## Key Directories

### `@apps/`

This directory contains the individual, deployable applications of the monorepo.

- **`@apps/api/`**: Contains the backend API for the project.
    - `src/`: Source code for the API.
        - `controllers/`: Request handlers that orchestrate business logic by interacting with services and repositories, and then return HTTP responses. (e.g., `usersController.ts`, `postsController.ts`)
        - `middleware/`: Functions that execute during the request-response cycle, often used for authentication, logging, error handling, or request validation. (e.g., `authMiddleware.ts`)
        - `routes/`: Defines the API endpoints (e.g., `/users`, `/posts`) and maps them to their respective controller functions. (e.g., `userRoutes.ts`)
        - `scripts/`: Utility scripts specific to the API application (e.g., database seeding, deployment scripts).
        - `container.ts`: Likely sets up InversifyJS or a similar dependency injection container.
        - `index.ts`: Entry point for the API application, setting up the server and middleware.
        - `env.ts`: Defines and validates environment variables for the API.
- **`@apps/web/`**: Contains the frontend web application, built with Next.js.
    - `.next/`: Build output, cache, and server files generated by Next.js during development and build processes.
    - `public/`: Static assets that are served directly from the root of the application (e.g., images, favicons).
    - `src/`: Source code for the Next.js web application.
        - `app/`: Core application logic, routing, and UI components using the Next.js App Router.
            - `(auth)/`: Route group for authentication-related pages (e.g., `login/page.tsx`, `onboard/page.tsx`). The parentheses indicate these are route groups and don't affect the URL path.
            - `(root)/`: Route group for the main application pages after authentication.
                - `[id]/`: Dynamic route segment, likely for displaying content based on an identifier (e.g., a specific user profile, a competition).
                    - `activity/page.tsx`: Page displaying activity for a specific item.
                    - `competitions/page.tsx`: Page displaying competitions related to a specific item.
                    - `integrations/page.tsx`: Page for managing integrations.
                    - `listings/page.tsx`: Page for listings.
                    - `offers/page.tsx`: Page for offers.
                    - `page.tsx`: Main page for the dynamic `[id]` route.
                    - `performance/page.tsx`: Page for performance metrics.
                    - `progress/page.tsx`: Page for progress tracking.
                    - `runs/page.tsx`: Page for displaying runs.
                    - `settings/page.tsx`: Page for settings related to the item.
                - `admin/page.tsx`: Page for administrative functionalities.
                - `competition/page.tsx`: Page for viewing a specific competition.
                - `leaderboard/page.tsx`: Page displaying leaderboards.
                - `marketplace/page.tsx`: Page for the marketplace.
                - `pack/page.tsx`: Page for viewing packs.
                - `page.tsx`: The main landing page of the authenticated application.
                - `profile/`: User profile section with its own sub-routes mirroring the `[id]` structure for user-specific content.
                - `rewards/page.tsx`: Page for viewing rewards.
            - `refresh/page.tsx`: A page likely used for token refresh or session management.
            - `layout.tsx`: The main layout component for the application, wrapping all pages.
            - `globals.css`: Global CSS styles for the application.
            - `icon.ico`: Application's favicon.
            - `fonts/`: Directory for custom fonts.
        - `components/`: Reusable UI components shared across the web application (e.g., buttons, forms, modals).
            - `admin/`: Components specific to the admin section.
            - `auth/`: Components specific to authentication.
            - `competitions/`: Components for displaying competition information.
            - `feed/`: Components related to activity feeds.
            - `leaderboard/`: Components for leaderboards.
            - `marketplace/`: Components for the marketplace.
            - `packs/`: Components for displaying packs.
            - `profile/`: Components specific to user profiles.
            - `ui/`: Generic, low-level UI building blocks (e.g., `Button.tsx`, `Input.tsx`).
        - `context/`: React Context API providers for global state management (e.g., `AuthContext.tsx`, `ThemeContext.tsx`).
        - `hooks/`: Custom React hooks for reusable logic (e.g., `useAuth.ts`, `useApi.ts`).
        - `lib/`: Utility functions and helper libraries specific to the web application (e.g., date formatting, API client setup).
        - `queries/`: Data fetching logic, likely using a library like TanStack Query (React Query) or SWR for managing server state.
        - `middleware.ts`: Next.js middleware for handling requests before they reach a page, often used for authentication or redirects.
        - `env.ts`: Defines and validates environment variables for the web app.

### `@packages/`

This directory contains shared packages (libraries, utilities) used across different applications (`api`, `web`) in the monorepo.

- **`@packages/aws/`**: Code related to AWS services integration.
    - `src/`: Source code for AWS utilities.
        - `ops/`: Operational scripts or configurations for AWS services (e.g., S3, Lambda).
        - `env.ts`: Environment variable definitions for AWS package.
        - `index.ts`: Main export file for the AWS package.
- **`@packages/contracts/`**: Smart contracts for the project, likely for blockchain interactions (e.g., Ethereum).
    - `lib/`: External library dependencies for smart contracts (e.g., `forge-std`, `openzeppelin-contracts`).
    - `script/`: Scripts for deploying, testing, or interacting with smart contracts (e.g., using Hardhat or Foundry).
    - `src/`: Source code of the smart contracts (Solidity files like `.sol`).
        - `abi/`: JSON ABI (Application Binary Interface) files for interacting with deployed contracts.
        - `interfaces/`: Solidity interfaces (`.sol` files defining contract function signatures).
        - `lib/`: Potentially for internal contract libraries.
        - `Minter.sol`, `Exchange.sol`, `Executor.sol`, `PhytCards.sol`: Core smart contract files.
    - `test/`: Tests for the smart contracts.
- **`@packages/drizzle/`**: Configuration and utilities for Drizzle ORM, used for database interactions.
    - `migrations/`: Database schema migration files generated by Drizzle.
        - `meta/`: Metadata about migrations.
    - `src/`: Source code for Drizzle setup and utilities.
        - `ops/`: Operational scripts related to the database (e.g., migration scripts).
        - `db.ts`: Drizzle client instance setup.
        - `schema.ts`: Defines the database schema (tables, columns, relations).
        - `relations.ts`: Defines explicit relations between tables for Drizzle.
        - `seed.ts`: Script for seeding the database with initial data.
        - `reset.ts`: Script for resetting the database.
        - `transactions.ts`: Utility functions for database transactions.
        - `env.ts`: Environment variables for Drizzle.
        - `index.ts`: Main export file.
- **`@packages/dto/`**: Data Transfer Objects (DTOs) defining the structure of data exchanged between layers or services (e.g., API requests/responses).
    - `src/`: Source code for DTOs.
        - `core.ts`: Base or shared DTO structures or utilities.
        - `index.ts`: Exports all DTOs.
        - Individual DTO files (e.g., `usersDTO.ts`, `postsDTO.ts`, `runsDTO.ts`).
- **`@packages/eslint/`**: Shared ESLint configurations for maintaining code quality and consistency across the monorepo.
    - `src/`: ESLint configuration files.
        - `base.ts`: Base ESLint rules.
        - `next.ts`: ESLint rules specific to Next.js projects.
        - `drizzle.ts`: ESLint rules specific to Drizzle ORM usage.
        - `server.ts`: ESLint rules for server-side code.
        - `index.ts`: Main ESLint configuration that likely extends others.
- **`@packages/infra/`**: Infrastructure as Code (IaC) definitions (e.g., using AWS CDK, Terraform, or Pulumi) to manage cloud resources.
    - `src/`: Source code for infrastructure definitions.
        - `awsClient.ts`: Client for interacting with AWS.
        - `privyClient.ts`: Client for interacting with Privy (authentication service).
        - `viemClient.ts`: Client for interacting with Ethereum using Viem.
        - `env.ts`, `errors.ts`, `index.ts`, `server.ts`: Other utility files.
- **`@packages/models/`**: Data models representing the structure of data entities, often used with an ORM or for defining business objects. These might be similar to Drizzle schema but could be a separate abstraction.
    - `src/`: Source code for data models.
        - `core.ts`: Base model structures or utilities.
        - `index.ts`: Exports all models.
        - Individual model files (e.g., `usersModel.ts`, `runsModel.ts`).
- **`@packages/repositories/`**: Data access layer, abstracting database interactions and providing a clean API for services to fetch and manipulate data.
    - `src/`: Source code for repositories.
        - `index.ts`: Exports all repositories.
        - Individual repository files (e.g., `usersRepo.ts`, `postsRepo.ts`), often interacting with Drizzle or other ORMs.
- **`@packages/services/`**: Business logic layer containing the core functionalities of the application. Services use repositories to interact with data and are called by controllers or other services.
    - `src/`: Source code for services.
        - `index.ts`: Exports all services.
        - Individual service files (e.g., `usersServices.ts`, `marketplaceServices.ts`, `runsServices.ts`).
- **`@packages/tsconfig/`**: Shared TypeScript `tsconfig.json` configurations to ensure consistency across different packages and applications. Likely contains base configurations that other `tsconfig.json` files in the monorepo extend.
- **`@packages/types/`**: Shared TypeScript type definitions and interfaces used across the monorepo to ensure type safety and consistency.
    - `src/`: Source code for type definitions.
        - `core.ts`: Core or common type definitions.
        - `index.ts`: Exports all types, often a large file aggregating types from other files.
        - Individual type definition files (e.g., `users.ts`, `runs.ts`, `cards.ts`).

## Other Notable Folders

- `.cursor/` or `.cursor.default/`: Cursor AI rules (like this one) and metadata.
    - `rules/`: Contains markdown files defining rules and codebase context for the AI.
- `.husky/`: Git hooks configuration (e.g., pre-commit, pre-push scripts for linting, testing).
- `.turbo/`: Turborepo cache and logs. Avoid manual changes here.
- `.vscode/` or `.vscode.default/`: VS Code editor configurations, settings, and recommended extensions for the project.

Refer to this rule for a detailed overview of the project structure and the purpose of each directory and key file.
